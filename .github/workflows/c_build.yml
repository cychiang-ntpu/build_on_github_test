name: C 語言建置流程

# 觸發條件：當 push 程式碼到任何分支時
on: [push]

jobs:
  build:
    # 執行環境：使用預裝了 GCC 的最新 Ubuntu 虛擬機
    runs-on: ubuntu-latest
    
    steps:
      # 步驟 1: 取得 repo 中的程式碼
      - name: Checkout code
        uses: actions/checkout@v4 
        
      # 步驟 2: 編譯 C 語言程式
      # 使用 GCC 編譯 main.c，輸出名為 by_pass_c 的可執行檔
      - name: Compile C program (GCC)
        run: gcc main.c -o by_pass_c
        
      # 步驟 3: 下載文字檔
      - name: Download text file with curl
        run: curl -o cano.txt https://sherlock-holm.es/stories/plain-text/cano.txt
        
      # 步驟 4: 運行並驗證程式（直接執行程式）
      - name: Run compiled application
        run: ./by_pass_c cano.txt output.txt
        
      # 步驟 5: 檢驗輸出檔案是否正確
      - name: Verify output file
        run: |
          if diff cano.txt output.txt > /dev/null; then
            echo "✓ 測試通過: output.txt 與 cano.txt 內容相同"
          else
            echo "✗ 測試失敗: output.txt 與 cano.txt 內容不同"
            exit 1
          fi
        
      # 步驟 6: 上傳建置成品（可選）
      # 將編譯好的可執行檔儲存為 Artifact，供下載
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: by_pass_c-executable
          path: by_pass_c
      
      # 步驟 7: 上傳建置成品（可選）
      # 將輸出檔案儲存為 Artifact，供下載
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: output-file
          path: output.txt